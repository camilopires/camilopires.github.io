---
export interface Props {
  title: string;
  description?: string;
  image?: string;
  type?: 'website' | 'article' | 'profile';
  publishedTime?: string;
  modifiedTime?: string;
  author?: string;
  section?: string;
  tags?: string[];
  canonicalURL?: string;
}

import '../styles/global.css';
import Footer from '../components/Footer.astro';

const { 
  title, 
  description = "Camilo Pires - Product Manager & App Developer passionate about creating impactful digital experiences",
  image = "/images/CP Headshot.jpg",
  type = "website",
  publishedTime,
  modifiedTime,
  author = "Camilo Pires",
  section,
  tags = [],
  canonicalURL
} = Astro.props;

// Generate canonical URL
const canonical = canonicalURL || new URL(Astro.url.pathname, Astro.site).href;

// Generate structured data
const structuredData = {
  "@context": "https://schema.org",
  "@type": type === "article" ? "Article" : "WebPage",
  "name": title,
  "description": description,
  "url": canonical,
  "mainEntity": type === "article" ? {
    "@type": "Article",
    "headline": title,
    "description": description,
    "image": new URL(image, Astro.site).href,
    "author": {
      "@type": "Person",
      "name": author,
      "url": "https://camilopires.co.uk"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Camilo Pires",
      "logo": {
        "@type": "ImageObject",
        "url": "https://camilopires.co.uk/favicon.svg"
      }
    },
    "datePublished": publishedTime,
    "dateModified": modifiedTime || publishedTime,
    "articleSection": section,
    "keywords": tags.join(", ")
  } : undefined,
  "author": {
    "@type": "Person",
    "name": "Camilo Pires",
    "jobTitle": "Product Manager & App Developer",
    "url": "https://camilopires.co.uk",
    "sameAs": [
      "https://www.linkedin.com/in/camilo-pires"
    ],
    "image": new URL(image, Astro.site).href
  },
  "publisher": {
    "@type": "Organization",
    "name": "Camilo Pires",
    "url": "https://camilopires.co.uk",
    "logo": {
      "@type": "ImageObject",
      "url": "https://camilopires.co.uk/favicon.svg"
    }
  }
};

// Remove undefined values from structured data
const cleanStructuredData = JSON.parse(JSON.stringify(structuredData));
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <meta name="version" content={new Date().toISOString().split('T')[0]} />
    <title>{title}</title>
    
    <!-- Canonical URL -->
    <link rel="canonical" href={canonical} />
    
    <!-- Performance optimizations -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="dns-prefetch" href="https://www.linkedin.com" />
    
    <!-- Preload critical resources -->
    <!-- Removed CP Headshot preload as it's only used for meta tags, not displayed content -->
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={type} />
    <meta property="og:url" content={canonical} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={new URL(image, Astro.site).href} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:site_name" content="Camilo Pires" />
    <meta property="og:locale" content="en_GB" />
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonical} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={new URL(image, Astro.site).href} />
    <meta property="twitter:creator" content="@camilopires" />
    
    <!-- Additional SEO Meta Tags -->
    <meta name="author" content={author} />
    <meta name="robots" content="index, follow" />
    <meta name="theme-color" content="#0284c7" />
    <meta name="msapplication-TileColor" content="#0284c7" />
    
    <!-- Keywords -->
    {tags.length > 0 && <meta name="keywords" content={tags.join(", ")} />}
    
    <!-- Article specific meta tags -->
    {type === "article" && publishedTime && (
      <meta property="article:published_time" content={publishedTime} />
    )}
    {type === "article" && modifiedTime && (
      <meta property="article:modified_time" content={modifiedTime} />
    )}
    {type === "article" && author && (
      <meta property="article:author" content={author} />
    )}
    {type === "article" && section && (
      <meta property="article:section" content={section} />
    )}
    {type === "article" && tags.length > 0 && tags.map(tag => (
      <meta property="article:tag" content={tag} />
    ))}
    
    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Structured Data -->
    <script type="application/ld+json" is:inline set:html={JSON.stringify(cleanStructuredData)} />
  </head>
  <body class="bg-gray-50 text-gray-900">
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-blue-600 text-white px-4 py-2 rounded z-50">
      Skip to main content
    </a>
    <slot />
    <Footer />
  </body>
</html>
